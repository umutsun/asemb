{
  "name": "RSS Feed Processor",
  "nodes": [
    {
      "parameters": {
        "rule": {
          "interval": [
            {
              "field": "hours",
              "hoursInterval": 1
            }
          ]
        }
      },
      "id": "schedule_trigger",
      "name": "Schedule Trigger",
      "type": "n8n-nodes-base.scheduleTrigger",
      "typeVersion": 1.1,
      "position": [250, 300]
    },
    {
      "parameters": {
        "url": "={{ $json.feedUrl || 'https://example.com/rss' }}"
      },
      "id": "rss_feed_reader",
      "name": "RSS Feed Reader",
      "type": "n8n-nodes-base.rssFeedRead",
      "typeVersion": 1,
      "position": [450, 300]
    },
    {
      "parameters": {
        "conditions": {
          "dateTime": [
            {
              "value1": "={{ $json.pubDate }}",
              "operation": "after",
              "value2": "={{ $now.minus({ hours: 24 }) }}"
            }
          ]
        }
      },
      "id": "filter_new_items",
      "name": "Filter New Items",
      "type": "n8n-nodes-base.if",
      "typeVersion": 2,
      "position": [650, 300]
    },
    {
      "parameters": {
        "url": "={{ $json.link }}",
        "extractMetadata": true,
        "cleanContent": true,
        "extractStructuredData": false
      },
      "id": "scrape_article",
      "name": "Scrape Article",
      "type": "webScrapeEnhanced",
      "typeVersion": 1,
      "position": [850, 250]
    },
    {
      "parameters": {
        "text": "={{ $json.content }}",
        "chunkSize": 800,
        "chunkOverlap": 150
      },
      "id": "chunk_article",
      "name": "Chunk Article",
      "type": "textChunk",
      "typeVersion": 1,
      "position": [1050, 250]
    },
    {
      "parameters": {
        "operation": "process",
        "documents": "={{ $json }}",
        "processingType": "batch",
        "enhanceMetadata": true
      },
      "id": "document_processor",
      "name": "Document Processor",
      "type": "documentProcessor",
      "typeVersion": 1,
      "position": [1250, 250]
    },
    {
      "parameters": {
        "operation": "embedStore",
        "text": "={{ $json.text }}",
        "documentId": "={{ 'rss_' + $json.id }}",
        "metadata": "={{ JSON.stringify({ source: 'rss', feedUrl: $node['schedule_trigger'].json.feedUrl, title: $json.title, link: $json.link, pubDate: $json.pubDate, chunk_index: $json.chunk_index }) }}"
      },
      "id": "generate_embeddings",
      "name": "Generate Embeddings",
      "type": "aliceSemanticBridgeEnhanced",
      "typeVersion": 1,
      "position": [1450, 250],
      "credentials": {
        "aliceSemanticBridgeApi": {
          "id": "1",
          "name": "Alice API"
        }
      }
    },
    {
      "parameters": {
        "documents": "={{ $json }}",
        "collection": "rss_content",
        "upsertMode": "merge"
      },
      "id": "store_pgvector",
      "name": "Store in PgVector",
      "type": "pgvectorUpsert",
      "typeVersion": 1,
      "position": [1650, 250],
      "credentials": {
        "pgvectorApi": {
          "id": "1",
          "name": "PgVector DB"
        }
      }
    },
    {
      "parameters": {
        "values": {
          "string": [
            {
              "name": "status",
              "value": "skipped"
            },
            {
              "name": "reason",
              "value": "Article already processed or too old"
            }
          ]
        },
        "options": {}
      },
      "id": "set_skipped",
      "name": "Set Skipped",
      "type": "n8n-nodes-base.set",
      "typeVersion": 3.2,
      "position": [850, 350]
    },
    {
      "parameters": {
        "channel": "rss:processing:complete",
        "message": "={{ JSON.stringify({ feedUrl: $node['schedule_trigger'].json.feedUrl, itemsProcessed: $items().length, timestamp: $now }) }}"
      },
      "id": "redis_notify",
      "name": "Redis Notification",
      "type": "redisPublish",
      "typeVersion": 1,
      "position": [1850, 300],
      "credentials": {
        "redisApi": {
          "id": "1",
          "name": "Redis Cache"
        }
      }
    },
    {
      "parameters": {
        "batchSize": 10,
        "options": {}
      },
      "id": "batch_items",
      "name": "Batch Items",
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [450, 450]
    },
    {
      "parameters": {
        "operation": "logActivity",
        "activityType": "rss_processing",
        "details": "={{ JSON.stringify({ feedUrl: $node['schedule_trigger'].json.feedUrl, itemsTotal: $node['rss_feed_reader'].json.length, itemsProcessed: $items('store_pgvector').length }) }}"
      },
      "id": "log_activity",
      "name": "Log Activity",
      "type": "dashboard",
      "typeVersion": 1,
      "position": [2050, 300]
    }
  ],
  "connections": {
    "Schedule Trigger": {
      "main": [
        [
          {
            "node": "RSS Feed Reader",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "RSS Feed Reader": {
      "main": [
        [
          {
            "node": "Batch Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Batch Items": {
      "main": [
        [
          {
            "node": "Filter New Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Filter New Items": {
      "main": [
        [
          {
            "node": "Scrape Article",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Set Skipped",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Scrape Article": {
      "main": [
        [
          {
            "node": "Chunk Article",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Chunk Article": {
      "main": [
        [
          {
            "node": "Document Processor",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Document Processor": {
      "main": [
        [
          {
            "node": "Generate Embeddings",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Generate Embeddings": {
      "main": [
        [
          {
            "node": "Store in PgVector",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Store in PgVector": {
      "main": [
        [
          {
            "node": "Redis Notification",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Redis Notification": {
      "main": [
        [
          {
            "node": "Log Activity",
            "type": "main",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1",
    "saveDataSuccessExecution": "all",
    "saveExecutionProgress": true,
    "saveManualExecutions": true,
    "executionTimeout": 900,
    "errorWorkflow": "error-handler"
  },
  "tags": ["template", "rss", "feed-processing", "pgvector", "scheduled"],
  "pinData": {},
  "versionId": "1.0.0"
}